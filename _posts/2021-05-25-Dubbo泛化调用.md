---
layout:     post
title:      Dubbo泛化调用
subtitle:   Dubbo泛化调用：如何在没有接口的情况下进行泛化调用？
date:       2021-05-25
author:     LG
header-img: img/post-bg-cook.jpg
catalog: true
tags:
    - Java
    - Dubbo
    - 分布式
    
---



##  Dubbo异常处理


### 1. 问题

在使用Dubbo进行系统间的调用的时候，我们有时候可能会遇到这样的问题:服务提供者抛出了自定义的业务异常，但是服务消费者
接收到的却是RunTimeException。这是为什么呢？这就得从Dubbo的ExceptionFilter说起。


### 2. ExceptionFilter源码分析

com.alibaba.dubbo.rpc.filter.ExceptionFilter ，实现 Filter 接口，异常过滤器实现类。代码如下：

![](https://tva1.sinaimg.cn/large/008i3skNgy1gqsgyrvbxoj31e00u04bv.jpg)


### 3. 测试一下

#### 定义一个接口
![](https://tva1.sinaimg.cn/large/008i3skNgy1gquz3zz91lj30k509c0td.jpg)

#### 定义一个实现类
![](https://tva1.sinaimg.cn/large/008i3skNgy1gquz4cd9i3j30m808adgn.jpg)

#### 通过dubbo-provider.xml暴露接口
![](https://tva1.sinaimg.cn/large/008i3skNgy1gquz4qy2s7j314i05wgnf.jpg)

#### provider整体结构
![](https://tva1.sinaimg.cn/large/008i3skNgy1gquz51darij30jv0910ty.jpg)

#### 通过dubbo-consumer.xml引用接口
![](https://tva1.sinaimg.cn/large/008i3skNgy1gquz5b8nycj30uk062t9u.jpg)

#### 在consumer/Application中引入泛型类
![](https://tva1.sinaimg.cn/large/008i3skNgy1gquz5ii1q3j312i0ca77t.jpg)

### 4. 如何正确捕获业务异常

1. 修改ExceptionFilter的源码，抛出自定义异常。最好是定义一个白名单，白名单里面的异常是可以直接抛出的

```json
String className = exception.getClass().getName();
if (className.startsWith("java.") || className.startsWith("javax.")) {
	return result;
}
// directly throw if it's dubbo exception
if (exception instanceof RpcException) {
	return result;
}
//在这里添加我自己定义的异常类
if (exception instanceof  SelfException) {
return result;
}
```

2. 自定义Exception类和接口在同一个package中

![](https://tva1.sinaimg.cn/large/008i3skNgy1gqshmfkgesj30n40ge0ua.jpg)


### 5. 鸣谢

[Dubbo异常处理](https://www.cnblogs.com/luozhiyun/p/10251585.html)
[Dubbo异常](http://svip.iocoder.cn/Dubbo/filter-exception-filter/)